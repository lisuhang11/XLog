# XLog - 轻量级 C++ 日志库

## 一、项目简介

XLog 是为 **C++17 及以上项目** 设计的轻量级日志库，专注于**高效、线程安全**地记录日志。支持**日志分级、自动文件滚动、流式语法、上下文信息（文件 / 行号 / 时间）** ，助力开发者快速定位问题，追踪程序运行状态。

核心设计参考工业级日志库理念（非直接依赖 Gin/Gorm ，但借鉴其简洁、可靠思路 ），适合中小型项目快速集成。

## 二、核心功能

| 功能               | 说明                                                         |
| ------------------ | ------------------------------------------------------------ |
| **日志分级**       | 支持 `DEBUG/INFO/WARN/ERROR/FATAL` 5 级，可灵活控制输出级别  |
| **自动文件滚动**   | 日志文件达阈值（默认 10MB）自动创建新文件（如 `app.0.log` → `app.1.log` ） |
| **线程安全**       | 基于 `std::mutex` 保证多线程写入安全，日志不混乱             |
| **流式语法**       | 支持 `LOG_DEBUG << "x=" << x` ，像 `std::cout` 一样拼接日志内容 |
| **上下文信息**     | 自动记录**时间（毫秒级）、文件路径、行号**，便于问题溯源     |
| **C++17 特性依赖** | 利用 `std::filesystem` 自动创建目录，简化部署                |

## 三、快速上手

### 1. 环境依赖

- **编译器**：支持 C++17 的编译器（GCC 8+/Clang 7+/MSVC 2019+）
- **标准库**：依赖 `<filesystem>`（C++17 引入）、`<mutex>`、`<fstream>` 等

### 2. 使用步骤

#### （1）引入头文件

#include "Log.h"
using namespace xlog; // 简化命名空间



#### （2）初始化日志

在程序启动处配置**日志目录、基础文件名、滚动阈值**：

```cpp
int main() {
    // 示例：日志存 ./logs 目录，基础名 app，超过 10MB 自动滚动
    Logger::getInstance().init(
        "./logs",   // 日志目录（自动创建，依赖 C++17 std::filesystem）
        "app",      // 日志文件基础名（生成 app.0.log、app.1.log 等）
        10 * 1024 * 1024  // 滚动阈值（10MB）
    );

    // 设置输出级别（仅输出 >= INFO 的日志，DEBUG 会被过滤）
    Logger::getInstance().set_level(LogLevel::INFO); 

    // 后续业务逻辑...
    return 0;
}
```



#### （3）记录日志（流式语法）

支持类似 `std::cout` 的拼接方式，自动附加**时间、文件、行号**：

```cpp
// DEBUG 级（若级别设为 INFO 则不输出）
LOG_DEBUG << "调试信息：x = " << 10 << ", y = " << 20;  

// INFO 级（必输出，记录程序启动）
LOG_INFO << "程序启动，加载配置完成";  

// WARN 级（警告：参数使用默认值）
LOG_WARN << "警告：参数 [timeout] 未配置，使用默认值 5s";  

// ERROR 级（错误：文件解析失败）
LOG_ERROR << "错误：config.json 解析失败，内容：" << loadConfigError();  

// FATAL 级（致命错误，需立即处理）
LOG_FATAL << "致命错误：数据库连接丢失，退出程序";  
```

#### （4）编译运行（以 G++ 为例）

bash

```bash
g++ -std=c++17 main.cpp -o app && ./app  
```

日志文件会生成在 `./logs` 目录，内容示例：

```plaintext
2024-01-01 10:05:30.123 [ INFO ] main.cpp:10 | 程序启动，加载配置完成  
2024-01-01 10:05:30.125 [ ERROR ] main.cpp:12 | 错误：config.json 解析失败，内容：...  
```

## 四、高级特性

### 1. 多线程安全测试

XLog 内置线程安全保护，多线程场景无需额外处理：

```cpp
void worker(int id) {
    for (int i = 0; i < 3; ++i) {
        LOG_INFO << "线程 " << id << " 执行任务：" << i;
    }
}

int main() {
    Logger::getInstance().init("./logs", "multi", 10*1024*1024);
    
    std::thread t1(worker, 1);
    std::thread t2(worker, 2);
    t1.join();
    t2.join();
    return 0;
}
```

日志会按线程安全方式写入，内容清晰不冲突。

### 2. 动态调整日志级别

运行时可修改输出级别，灵活控制日志量：

cpp

```cpp
// 生产环境默认 INFO，调试时临时开启 DEBUG
if (isDebugMode()) {
    Logger::getInstance().set_level(LogLevel::DEBUG);
}
```



### 3. 自定义日志路径与阈值

```cpp
// 示例：日志存 /var/log/myapp，基础名 myapp，阈值 5MB
Logger::getInstance().init("/var/log/myapp", "myapp", 5*1024*1024);  
```



## 五、适用场景

- **服务端程序**：后台服务（Web、守护进程）持久化记录运行状态。
- **调试阶段**：开发时用 `LOG_DEBUG` 输出变量、流程，上线后过滤。
- **多线程项目**：保证日志线程安全，精准定位并发问题。

## 六、注意事项

1. **C++17 环境依赖**：
   - 若编译器不支持 `std::filesystem`（如旧版 MSVC），需手动创建日志目录，或替换 `init` 中 `std::filesystem::create_directories` 为 `mkdir` 等兼容逻辑。
2. **性能考量**：
   - 高频日志场景（如每秒千条），同步写入可能阻塞线程。可扩展为**异步日志**（本库当前为同步实现，需自行扩展）。
3. **日志级别规范**：
   - 生产环境建议关闭 `DEBUG` 级别，减少日志量，提升性能与可读性。

通过 XLog，你可以用 **C++17 简洁语法** 实现工业级日志管理，快速为项目添加 “黑匣子”，让调试、运维更高效！

如果需要扩展异步写入、日志压缩等功能，可基于现有架构轻松扩展～